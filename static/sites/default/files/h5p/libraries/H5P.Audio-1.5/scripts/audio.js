var H5P=H5P||{};H5P.Audio=(function($){function C(params,id,extras){H5P.EventDispatcher.call(this);this.contentId=id;this.params=params;this.extras=extras;this.toggleButtonEnabled=true;if(extras&&extras.previousState!==undefined){this.oldTime=extras.previousState.currentTime;}
this.params=$.extend({},{playerMode:'minimalistic',fitToWrapper:false,controls:true,autoplay:false,audioNotSupported:"Your browser does not support this audio",playAudio:"Play audio",pauseAudio:"Pause audio"},params);if(this.params.playerMode==='transparent'){this.params.fitToWrapper=true;}
this.on('resize',this.resize,this);}
C.prototype=Object.create(H5P.EventDispatcher.prototype);C.prototype.constructor=C;C.prototype.addMinimalAudioPlayer=function($container,transparentMode){var INNER_CONTAINER='h5p-audio-inner';var AUDIO_BUTTON='h5p-audio-minimal-button';var PLAY_BUTTON='h5p-audio-minimal-play';var PLAY_BUTTON_PAUSED='h5p-audio-minimal-play-paused';var PAUSE_BUTTON='h5p-audio-minimal-pause';var self=this;this.$container=$container;self.$inner=$('<div/>',{'class':INNER_CONTAINER+(transparentMode?' h5p-audio-transparent':'')}).appendTo($container);var audioButton=$('<button/>',{'class':AUDIO_BUTTON+" "+PLAY_BUTTON,'aria-label':this.params.playAudio}).appendTo(self.$inner).click(function(){if(!self.isEnabledToggleButton()){return;}
this.setAttribute('aria-hidden','true');if(self.audio.paused){self.play();}
else{self.pause();}}).on('focusout',function(){this.setAttribute('aria-hidden','false');});if(this.params.fitToWrapper){audioButton.css({'width':'100%','height':'100%'});}
self.audio.addEventListener('ended',function(){audioButton.attr('aria-hidden',false).attr('aria-label',self.params.playAudio).removeClass(PAUSE_BUTTON).removeClass(PLAY_BUTTON_PAUSED).addClass(PLAY_BUTTON);});self.audio.addEventListener('play',function(){audioButton.attr('aria-label',self.params.pauseAudio).removeClass(PLAY_BUTTON).removeClass(PLAY_BUTTON_PAUSED).addClass(PAUSE_BUTTON);});self.audio.addEventListener('pause',function(){audioButton.attr('aria-hidden',false).attr('aria-label',self.params.playAudio).removeClass(PAUSE_BUTTON).addClass(PLAY_BUTTON_PAUSED);});this.$audioButton=audioButton;self.resize();};C.prototype.resize=function(){if(this.params.fitToWrapper&&this.$container&&this.$container.width()){var w=this.$container.width();var h=this.$container.height();if(w<h){this.$audioButton.css({'font-size':w/2+'px'});}
else{this.$audioButton.css({'font-size':h/2+'px'});}}};return C;})(H5P.jQuery);H5P.Audio.prototype.attach=function($wrapper){const self=this;$wrapper.addClass('h5p-audio-wrapper');var audio=document.createElement('audio');if(audio.canPlayType===undefined){this.attachNotSupportedMessage($wrapper);return;}
if(this.params.files!==undefined&&this.params.files instanceof Object){for(var i=0;i<this.params.files.length;i++){var file=this.params.files[i];if(audio.canPlayType(file.mime)){var source=document.createElement('source');source.src=H5P.getPath(file.path,this.contentId);source.type=file.mime;audio.appendChild(source);}}}
if(!audio.children.length){this.attachNotSupportedMessage($wrapper);return;}
if(this.endedCallback!==undefined){audio.addEventListener('ended',this.endedCallback,false);}
audio.className='h5p-audio';audio.controls=this.params.controls===undefined?true:this.params.controls;const controlsList='nodownload noplaybackrate';audio.setAttribute('controlsList',controlsList);audio.preload='auto';audio.style.display='block';if(this.params.fitToWrapper===undefined||this.params.fitToWrapper){audio.style.width='100%';if(!this.isRoot()){audio.style.height='100%';}}
this.audio=audio;if(this.params.playerMode==='minimalistic'){audio.controls=false;this.addMinimalAudioPlayer($wrapper,false);}
else if(this.params.playerMode==='transparent'){audio.controls=false;this.addMinimalAudioPlayer($wrapper,true);}
else{$wrapper.html(audio);}
if(audio.controls){$wrapper.addClass('h5p-audio-controls');}
if(this.oldTime){this.seekTo(this.oldTime);}
if(window.H5PEditor===undefined){self.autoPaused=true;new IntersectionObserver(function(entries){const entry=entries[0];if(entry.intersectionRatio==0){if(!self.audio.paused){self.autoPaused=true;self.audio.pause();}}
else if(self.params.autoplay&&self.autoPaused){self.autoPaused=false;self.audio.play();}},{root:document.documentElement,threshold:[0,1]}).observe($wrapper.get(0));}};H5P.Audio.prototype.attachNotSupportedMessage=function($wrapper){$wrapper.addClass('h5p-audio-not-supported');$wrapper.html('<div class="h5p-audio-inner">'+
'<div class="h5p-audio-not-supported-icon"><span/></div>'+
'<span>'+this.params.audioNotSupported+'</span>'+
'</div>');if(this.endedCallback!==undefined){this.endedCallback();}}
H5P.Audio.prototype.stop=function(){if(this.flowplayer!==undefined){this.flowplayer.stop().close().unload();}
if(this.audio!==undefined){this.audio.pause();}};H5P.Audio.prototype.play=function(){if(this.flowplayer!==undefined){this.flowplayer.play();}
if(this.audio!==undefined){this.audio.play();}};H5P.Audio.prototype.pause=function(){if(this.audio!==undefined){this.audio.pause();}};H5P.Audio.prototype.seekTo=function(seekTo){if(this.audio!==undefined){this.audio.currentTime=seekTo;}};H5P.Audio.prototype.getCurrentState=function(){if(this.audio!==undefined){const currentTime=this.audio.ended?0:this.audio.currentTime;return{currentTime:currentTime};}};H5P.Audio.prototype.disableToggleButton=function(){this.toggleButtonEnabled=false;if(this.$audioButton){this.$audioButton.addClass(H5P.Audio.BUTTON_DISABLED);}};H5P.Audio.prototype.enableToggleButton=function(){this.toggleButtonEnabled=true;if(this.$audioButton){this.$audioButton.removeClass(H5P.Audio.BUTTON_DISABLED);}};H5P.Audio.prototype.isEnabledToggleButton=function(){return this.toggleButtonEnabled;};H5P.Audio.BUTTON_DISABLED='h5p-audio-disabled';